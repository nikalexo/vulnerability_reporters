from pymongo import MongoClient
import xml.etree.ElementTree as ET
import sys

root = ET.parse("./../../config.xml") 

START = int(root.find("projects").find('.//product[@name=\'apache\']').find("bugs").find("begin").text)
END = int(root.find("projects").find('.//product[@name=\'apache\']').find("bugs").find("end").text)


'''if "-s" in sys.argv:
    index = sys.argv.index("-s")
    START = int(sys.argv[index+1])
    if "-e" in sys.argv:
        index = sys.argv.index("-e")
        END = int(sys.argv[index+1])
    else:
        sys.exit("Only year to start is given. Year to end is missing!")

years = range(START, END+1)'''

DB = root.find("mongodb").find("db").text
client = MongoClient()
db = client[DB]
collection = db[root.find("projects").find('.//product[@name=\'apache\']').find("collection").text]

apache_bug_2_comments = dict()
not_fetched = []
bugs = collection.find()

with open("apache_bugs.list", "w") as f:
    for bug in bugs:
        #if any(year in bug["last_change_time"] for year in years):
        f.write(str(bug['id']) + "\n")