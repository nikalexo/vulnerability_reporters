# Projects
The scripts in this folder and its subfolders download bugs of the projects **Apache Server**, **Linux Kernel**, **Mozilla (Firefox, Core, Thunderbird)** and **PHP** from their bug tracking systems and stores them in a mongodb database.

All, except PHP that has its own system, use an instance of the bug tracking system [bugzilla](https://www.bugzilla.org):  
- **[Apache Server](https://bz.apache.org/bugzilla/)**
- **[Linux Kernel](https://bugzilla.kernel.org/)**
- **[Mozilla](https://bugzilla.mozilla.org/)**
- **[PHP](https://bugs.php.net/)**

To fetch bugs from bugzilla, we use its api. Use **gen_url.py** to generate a url to fetch all bugs in a given period of one month or less and additionally if needed to reduce size of the json files, urls to fetch only the ids of bugs in a period and to fetch bugs seperately. A url is based on a specified **spec.json** file determing the parameters of the url.   
For PHP, we download the html files of all bugs and parse them to generate json files.  

Use **store_db.py** to store the bugs in a mongodb.  

See [./../config.xml](./../config.xml) for parameters used in the process as e.g. database name or collections.

## Fetching and storing bugs in database
### All projects together
***Attention!:*** The whole bug processing can take around 38 hours (Bugs from ~2000 until the middle of 2020).

#### All in one ...
<pre>
bash process_bugs.sh
</pre>

#### ... or step by step
<pre>
bash get_bugs.sh        # fetch all bugs for all projects
bash check_files.sh     # check files
bash store_all_db.sh    # store all bugs in the database 

# Apache specific
cd APACHE
python create_bug_list.py
python get_apache_comments.py
cd ..
python store_comments.py APACHE

# Linux specific
cd LINUX
bash comments_complete.sh
</pre>

### Apache
<pre>cd APACHE
bash request_bugs.sh            # fetch the bugs as json files
cd ..
python store_db.py APACHE       # store bugs in database
cd APACHE
python create_bug_list.py       # store all bug-ids in a new file (for comment fetching)
python get_apache_comments.py   # fetch the bug comments in a json file
cd ..
python store_comments.py APACHE # store comments in bugs in database
</pre>

### Linux
<pre>
cd LINUX
bash request_bugs.sh        # fetch bugs
cd ..
python store_db.py LINUX    # store bugs in database
cd LINUX
python comments_complete.sh # store all bug-ids in a new file (for comment fetching),
                            # fetch the bug comments in json files, 
                            # and store comments in bugs in database
</pre>

### Mozilla
<pre>
cd MOZILLA
bash request_bugs_core.sh           # fetch core bugs
bash request_bugs_firefox.sh        # fetch firefox bugs
bash request_bugs_thunderbird.sh    # fetch thunderburd bugs
python check_json_files.py core        # check correct formatting of json files
python check_json_files.py firefox     # needed if too many bugs per month
python check_json_files.py thunderbird # in this case, new fetching per day/bug-id
cd ..
python store_db.py MOZILLA -b bugs_core -c mozilla-core    # store core bugs
python store_db.py MOZILLA -b bugs_firefox -c firefox      # store firefox bugs
python store_db.py MOZILLA -b bugs_thunderbird -c thunderbird  # store thb. bugs
</pre>

### PHP
<pre>
cd PHP
bash request_bugs.sh    # download html files
python parse.py -m 10   # generate json files 
cd ..
python3 store_db.py PHP # store bugs in database
</pre>

### Updating
To update the database for **Mozilla**, **Apache**, and **Linux** follow these steps:

1. Open *./../config* and modify the *\<begin>* and *\<end>* tags in *\<bugs>* tag for the projects to update to the required years by specifying first year and last year.  
    - Example: To update 2020 set both to 2020
2. Run the request_bugs{_\<project>}.sh scripts as descripted above to fetch all bugs in the given period.
3. Project specific
    1. Apache comments  
        - Run *python create_bug_list.py -s \<begin> -e \<end>* to create a bug list of bugs last modified in the given period.
        - Run *python get_apache_comments.py* and *python store_comments.py APACHE* as descripted above.
    2. Linux comments
        - Follow the instructions as descripted above
    3. Mozilla formatting of json files
        - Run *python check_json_files.py \<project part>* as descripted above
4. Run *python store_db.py* as descripted above and add *-s* and *-e* to specify the updated period.
    - Example: python store_db.py MOZILLA -b bugs_core -c mozilla-core -s 2020 -e 2020

To update the database for **PHP** follow the instructions as descripted above. Unfortunately, it will download all bugs again. It can be necessary to increase <max-bug> in the config file if the max bug id is higher than the specified value. For example if highes bug-id is 80423 you can set value to 85000.