#!/bin/bash

if [ ! -d "./bugs_html" ]
then
    mkdir "./bugs_html"
fi

# get max bug id from config
phpline=$(awk '/<product name="php">/{ print NR; exit}' ./../../config.xml)
lastline=$(awk '/<\/config>/{ print NR; exit}' ./../../config.xml)
i=$phpline
maxbug=-1
while [ $i -lt $lastline ]
do
	content=$(awk '{if(NR=='$i') print $0}' ./../../config.xml)
	if grep -q "max-bug" <<< $content; then
		maxbug=$(sed -n "$i"p ./../../config.xml | grep -oPm1 "(?<=<max-bug>)[^<]+")
		break
	fi
	i=$((i+1))
done


file="./url"
for bug in $(seq 1 $maxbug);
do
	wget -q -O ./bugs_html/bug_$bug.html "https://bugs.php.net/bug.php?id=$bug"

	a=$(($bug % 100))
	if [ $a -eq 0 ]
	then
		sleep 5s        # Avoiding 429: Too many requests
	fi
done

echo "Done"