#!/usr/bin/env python
# coding: utf-8

# In[1]:


import json
import csv
import os, sys
import pandas as pd


# In[2]:


# 1. Fill statistics.csv with data from project specific json files
projects = ["Mozilla Core/Firefox", "PHP", "Linux", "Apache httpd-server", "Thunderbird", "Mozilla Suite"]
json_files = ["cve2commits-core-firefox.json", "cve2commits-php.json", "cve2commits-linux.json",
             "cve2commits-apache.json", "cve2commits-thunderbird.json", "cve2commits-mozilla-suite.json"]

first_line = ["Project","Total #CVEs of Project","#CVEs with at least one commit","% CVEs with at least one commit",
              "0","1","2","3","4","5","6","7","8","9","10.."]

try:
    os.remove("statistics.csv")
except:
    print("File 'statistics.csv' already deleted!")
    
with open("statistics.csv", 'a') as f:
    writer = csv.writer(f)
    writer.writerow(first_line)

count = [[] for x in range(len(projects))]
total_number = [0 for x in range(len(projects))]
min_one_commit = [0 for x in range(len(projects))]

for i in range(len(projects)):
    count[i] = [0 for x in range(11)]
    with open(json_files[i]) as jf:
        data = json.load(jf)
        total_number[i] = len(data)
    for key in data.keys():
        if len(data[key]) > 0:
            min_one_commit[i] += 1
        if len(data[key]) > 10:
            count[i][10] += 1
        else:
            count[i][len(data[key])] += 1
    
    fields = [projects[i], total_number[i], min_one_commit[i], min_one_commit[i]/total_number[i]*100, 
              total_number[i]-len(data.keys())]
    fields.extend(count[i][1:])
    with open("statistics.csv", 'a') as f:
        writer = csv.writer(f)
        writer.writerow(fields)


# In[4]:


# 2. Statistics
data = pd.read_csv("statistics.csv")
data.head(6)


# In[ ]:




