#!/usr/bin/env python
# coding: utf-8

# In[2]:


import json
import csv
import os
import pandas as pd


# In[6]:


# 1. Fill statistics.csv with data from project specific json files
projects = ["Mozilla Core/Firefox", "PHP", "Linux", "Apache httpd-server", "Thunderbird", "Mozilla Suite"]
json_files = ["cve2bugs-core-firefox.json", "cve2bugs-php.json", "cve2bugs-linux.json", "cve2bugs-apache.json"
             , "cve2bugs-thunderbird.json", "cve2bugs-mozilla-suite.json"]

first_line = ["Project","Total #CVEs","% CVEs with at least one bug","0","1","2","3","4","5","6","7","8","9","10.."]

try:
    os.remove("statistics.csv")
except:
    print("File 'statistics.csv' already deleted!")
    
with open("statistics.csv", 'a') as f:
    writer = csv.writer(f)
    writer.writerow(first_line)

count = [[] for x in range(len(projects))]
total_number = [0 for x in range(len(projects))]
for i in range(len(projects)):
    count[i] = [0 for x in range(11)]
    with open(json_files[i]) as jf:
        data = json.load(jf)
    for key in data.keys():
        if len(data[key]) > 10:
            count[i][10] += 1
        else:
            count[i][len(data[key])] += 1
    
    total_number[i] = len(data)
    fields = [projects[i], total_number[i], (sum(count[i])-count[i][0])/total_number[i]*100]
    fields.extend(count[i])
    with open("statistics.csv", 'a') as f:
        writer = csv.writer(f)
        writer.writerow(fields)
    


# In[7]:


# 2. Statistics
data = pd.read_csv("statistics.csv")
data.head(6)


# In[ ]:




