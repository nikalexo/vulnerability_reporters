from ParseMFSA import parse_mfsa
from ParseApache import parse_apache
from ParseReporters import parse_reporters_all, parse_reporters_one
import sys
import json

pkgs = ['mozilla-suite', 'apache', 'linux', 'php']

with open("./../../Mappings/Project_2_CVE/project2cves.json") as jf:
    project2cves = json.load(jf)

if __name__ == '__main__':
    if len(sys.argv) > 1 and sys.argv[1] in pkgs:
        if sys.argv[1] == 'mozilla' or sys.argv[1] == 'mozilla-suite':
            # Fetch cves and reporters from Mozilla Foundation Security Advisories used 
            # in parse_reporters_all() for Mozilla case
            parse_mfsa(project2cves["mozilla-suite"])
            parse_reporters_one(sys.argv[1], project2cves["mozilla-suite"])
        elif sys.argv[1] == 'apache':
            # Fetch cves and reporters from Mozilla Foundation Security Advisories used 
            # in parse_reporters_all() for Mozilla case
            parse_apache(project2cves["apache"])
            parse_reporters_one(sys.argv[1], project2cves["apache"])
        else:
            parse_reporters_one(sys.argv[1], project2cves[sys.argv[1]])
    else:
        # Fetch cves and reporters from Mozilla Foundation Security Advisories used 
        # in parse_reporters_all() for Mozilla case
        parse_mfsa(project2cves["mozilla-suite"])

        # Fetch cves and reporters from Apache Security Advisories used 
        # in parse_reporters_all() for Apache case
        parse_apache(project2cves["apache"])

        # Fetch cves and reporters for all projects
        parse_reporters_all(project2cves)
