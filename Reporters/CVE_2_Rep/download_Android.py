import requests
import json

# Load all cve ids
with open("./../../Mappings/Project_2_CVE/project2cves.json") as jf:
    project2cves = json.load(jf)

cve_list = []
for project in ['mozilla-suite', 'apache', 'linux', 'php']:
    cve_list.extend(project2cves[project])

cve_list = list(set(cve_list))

# Find already fetched Android Bulletins
try:
    with open("./android2info.json") as jf:
        android2info = json.load(jf)
    print("Opened all already downloaded Android Bulletins!")
    print(list(android2info.keys()))
except:
    android2info = dict()
    print("No local Android Bulletins found!")

# Download Android Bulletins
url_android = 'https://source.android.com/security/bulletin/'

all_ids = []
for year in range(2015, 2021):
        for month in range(1,13):
            all_ids.append(str(year)+'-'+'{0}'.format(str(month).zfill(2))+'-01')

for and_id in all_ids:
    try:
        URL = url_android+and_id
        temp = requests.get(URL)
        android2info[and_id] = temp.text
    except:
        print('WARNING: Some PROBLEM with Advisory: ', and_id)

with open("./android2info.json", "w") as jf:
    json.dump(android2info, jf)

print("Finished!")
