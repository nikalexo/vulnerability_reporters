import requests
import json
import sys
import traceback

try:
    with open("./dsa2info.json") as jf:
        dsa2info = json.load(jf)
    print("Opened all already downloaded DSAs!")
    print(list(dsa2info.keys()))
except:
    dsa2info = dict()
    print("No local DSAs found!")

current_dsa_id = 11

base_url = "https://www.debian.org/security/dsa-"

breakout = 0

print("Starting requesting DSAs...")

while True:
    if breakout >= 2:
        break           # two following ids not found -> stop no further ids available
    if str(current_dsa_id) not in list(dsa2info.keys()):
        # create url
        if current_dsa_id < 100:
            url = base_url + "0" + str(current_dsa_id) + ".en.html"
        else:
            url = base_url + str(current_dsa_id) + ".en.html"

        # make request
        try:
            r = requests.get(url)
            html_text = r.text
            if "Page not found" in html_text:
                breakout += 1
            else:
                print("Current dsa:", current_dsa_id)
                dsa2info[str(current_dsa_id)] = html_text
                breakout = 0
        except:
            print("Something went wrong!")
            traceback.print_exc()

    current_dsa_id += 1

with open("./dsa2info.json", "w") as jf:
    json.dump(dsa2info, jf)

print("Finished!")